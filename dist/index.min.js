"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}(),DataManager=function(){function t(e,a){if(_classCallCheck(this,t),this.props=e||{},this.parent=a,this.parent)for(this.root=this.parent;this.root.parent;)this.root=this.root.parent;this.initializeSubManagers(),this.initializeData()}return _createClass(t,[{key:"initializeSubManagers",value:function(){var t=this;this._submanagers||(this._submanagers=function(){if(!t.hasSubmanagers())return{};var e=function(){var e={};return Object.keys(t.getSubManagers()).forEach(function(a){var n=t.getSubManagers()[a];e[a]=new n(t.props[a],t),e[a].subscribe(t._changed.bind(t)),t[a]=e[a]}),{v:e}}();return"object"===("undefined"==typeof e?"undefined":_typeof(e))?e.v:void 0}())}},{key:"initializeData",value:function(){return this.state=this.mergeInitial(this.getInitialState())}},{key:"callbacks",value:function(){return this._callbacks||(this._callbacks=[]),this._callbacks}},{key:"getInitialState",value:function(){return{}}},{key:"subscribe",value:function(t){this.callbacks().push(t)}},{key:"unsubscribe",value:function(t){this._callbacks=this._callbacks.filter(function(e){return e!==t})}},{key:"hasSubmanagers",value:function(){return this.getSubManagers&&Object.keys(this.getSubManagers()).length>0}},{key:"mergeInitial",value:function(t){var e=this;return Object.keys(this._submanagers).forEach(function(a){t[a]=e._submanagers[a].initializeData()}),t}},{key:"getState",value:function(){var t=this,e={};return Object.keys(this.state).forEach(function(a){e[a]=t.state[a]}),Object.keys(this._submanagers).forEach(function(a){e[a]=t._submanagers[a].getState()}),e}},{key:"setState",value:function(t,e){var a=this;"undefined"==typeof e&&(e=!0),Object.keys(t).forEach(function(e){a._submanagers[e]?a._submanagers[e].setState(t[e],!1):a.state[e]=t[e]}),e&&this._changed()}},{key:"_changed",value:function(){var t=this;this.callbacks().forEach(function(e){return e(t.getState())})}},{key:"resetData",value:function(){var t=this;Object.keys(this._submanagers).forEach(function(e){t._submanagers[e].resetData()}),this.initializeData()}}]),t}();DataManager.rememberedStates=100,DataManager.createClass=function(t){var e=function(e,a){var n=this;return this.props=e,this.parent=a,this.props||(this.props={}),Object.keys(t).forEach(function(e){var a=t[e];"function"==typeof a?n[e]=a.bind(n):n[e]=a}),DataManager.call(this,e,a),this};return e.prototype=DataManager.prototype,e},"undefined"!=typeof module&&module.exports&&(module.exports["default"]=DataManager);